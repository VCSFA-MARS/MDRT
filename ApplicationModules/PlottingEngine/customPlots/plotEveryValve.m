dataFolders = '/Users/nick/data/archive/2021-02-19 - NG-15 Launch/data';
    
filesCommand = {
        '1003 RP1 DCVNC-1003 Ball Valve Ctl Param.mat';
        '1010 RP1 DCVNC-1010 Ball Valve Ctl Param.mat';
        '1021 RP1 DCVNC-1021 Ball Valve Ctl Param.mat';
        '1022 RP1 DCVNO-1022 Ball Valve Ctl Param.mat';
        '1023 RP1 DCVNC-1023 Ball Valve Ctl Param.mat';
        '1024 RP1 DCVNC-1024 Ball Valve Ctl Param.mat';
        '2002 LO2 DCVNC-2002 Ball Valve Ctl Param.mat';
        '2006 LO2 DCVNC-2006 Ball Valve Ctl Param.mat';
        '2010 LO2 DCVNO-2010 Ball Valve Ctl Param.mat';
        '2027 LO2 DCVNO-2027 Ball Valve Ctl Param.mat';
        '2031 LO2 DCVNC-2031 Ball Valve Ctl Param.mat';
        '2032 LO2 DCVNO-2032 Ball Valve Ctl Param.mat';
        '2035 LO2 DCVNO-2035 Ball Valve Ctl Param.mat';
        '2040 LO2 DCVNO-2040 Ball Valve Ctl Param.mat';
        '2056 LO2 DCVNC-2056 Ball Valve Ctl Param.mat';
        '2067 LO2 DCVNO-2067 Ball Valve Ctl Param.mat';
        '2093 LO2 DCVNC-2093 Ball Valve Ctl Param.mat';
        '2096 LO2 DCVNC-2096 Ball Valve Ctl Param.mat';
        '2097 LO2 DCVNC-2097 Ball Valve Ctl Param.mat';
        '2099 LO2 DCVNO-2099 Ball Valve Ctl Param.mat';
        '3009 LN2 DCVNC-3009 Ball Valve Ctl Param.mat';
        '3010 LN2 DCVNC-3010 Ball Valve Ctl Param.mat';
        '3014 LN2 DCVNC-3014 Ball Valve Ctl Param.mat';
        '3015 LN2 DCVNC-3015 Ball Valve Ctl Param.mat';
        '3025 LN2 DCVNC-3025 Ball Valve Ctl Param.mat';
        '3026 LN2 DCVNO-3026 Ball Valve Ctl Param.mat';
        '3051 LN2 DCVNC-3051 Ball Valve Ctl Param.mat';
        '3056 LN2 DCVNO-3056 Ball Valve Ctl Param.mat';
        '3066 LN2 DCVNC-3066 Ball Valve Ctl Param.mat';
        '3068 LN2 DCVNO-3068 Ball Valve Ctl Param.mat';
        '3092 LN2 DCVNC-3092 Ball Valve Ctl Param.mat';
        '3131 LN2 DCVNO-3131 Ball Valve Ctl Param.mat';
        '4061 Ghe DCVNO-4061 Ball Valve Ctl Param.mat';
        '4062 Ghe DCVNO-4062 Ball Valve Ctl Param.mat';
        '4063 Ghe DCVNC-4063 Ball Valve Ctl Param.mat';
        '4070 Ghe DCVNC-4070 Ball Valve Ctl Param.mat';
        '4083 Ghe DCVNC-4083 Ball Valve Ctl Param.mat';
        '4084 Ghe DCVNC-4084 Ball Valve Ctl Param.mat';
        '4085 Ghe DCVNC-4085 Ball Valve Ctl Param.mat';
        '4089 Ghe DCVNO-4089 Ball Valve Ctl Param.mat';
        '4106 Ghe DCVNC-4106 Ball Valve Ctl Param.mat';
        '4183 Ghe DCVNC-4183 Ball Valve Ctl Param.mat';
        '4193 Ghe DCVNC-4193 Ball Valve Ctl Param.mat';
        '5015 GN2 DCVNC-5015 Ball Valve Ctl Param.mat';
        '5047 GN2 DCVNO-5047 Ball Valve Ctl Param.mat';
        '5078 GN2 DCVNC-5078 Ball Valve Ctl Param.mat';
        '5079 GN2 DCVNO-5079 Ball Valve Ctl Param.mat';
        '5106 GN2 DCVNC-5106 Ball Valve Ctl Param.mat';
        '5126 GN2 DCVNC-5126 Ball Valve Ctl Param.mat';
        '5127 GN2 DCVNC-5127 Ball Valve Ctl Param.mat';
        '5178 GN2 DCVNO-5178 Ball Valve Ctl Param.mat';
        '5179 GN2 DCVNO-5179 Ball Valve Ctl Param.mat';
        '5198 GN2 DCVNC-5198 Ball Valve Ctl Param.mat';
        '5245 ECS DCVNC-5245 Ball Valve Ctl Param.mat';
        '5463 GN2 DCVNO-5463 Ball Valve Ctl Param.mat';
        '5464 GN2 DCVNC-5464 Ball Valve Ctl Param.mat';
        '8020 HSS DCVNO-8020 Ball Valve Ctl Param.mat';
        '8021 HSS DCVNO-8021 Ball Valve Ctl Param.mat';
        '8030 HSS DCVNC-8030 Ball Valve Ctl Param.mat';
        '8031 HSS DCVNC-8031 Ball Valve Ctl Param.mat';
        '8032 HSS DCVNC-8032 Ball Valve Ctl Param.mat';
        };

propCommand = {
        '1014 RP1 PCVNC-1014 Globe Valve Cmd Param.mat';
        '1015 RP1 PCVNC-1015 Globe Valve Cmd Param.mat';
        '1049 RP1 PCVNC-1049 Globe Valve Cmd Param.mat';
        '2013 LO2 PCVNO-2013 Globe Valve Cmd Param.mat';
        '2014 LO2 PCVNO-2014 Globe Valve Cmd Param.mat';
        '2029 LO2 PCVNO-2029 Globe Valve Cmd Param.mat';
        '2059 LO2 PCVNC-2059 Globe Valve Cmd Param.mat';
        '2069 LO2 PCVNC-2069 Globe Valve Cmd Param.mat';
        '2220 LO2 PCVNO-2220 Globe Valve Cmd Param.mat';
        '2221 LO2 PCVNC-2221 Globe Valve Cmd Param.mat';
        '3021 LN2 PCVNC-3021 Globe Valve Cmd Param.mat';
        '3028 LN2 PCVNC-3028 Globe Valve Cmd Param.mat';
        '3055 LN2 PCVNC-3055 Globe Valve Cmd Param.mat';
        '3070 LN2 PCVNC-3070 Globe Valve Cmd Param.mat';
        '3086 LN2 PCVNC-3086 Globe Valve Cmd Param.mat';
        '4168 Ghe PCVNC-4168 Globe Valve Cmd Param.mat';
        '5256 ECS PCVNC-5256 Globe Valve Cmd Param.mat';
        '5258 ECS PCVNC-5258 Globe Valve Cmd Param.mat';    
        };

filesState = {    
        '3131 LN2 DCVNO-3131 State.mat';
        '1003 RP1 DCVNC-1003 State.mat';
        '1010 RP1 DCVNC-1010 State.mat';
        '1021 RP1 DCVNC-1021 State.mat';
        '1022 RP1 DCVNO-1022 State.mat';
        '1023 RP1 DCVNC-1023 State.mat';
        '1024 RP1 DCVNC-1024 State.mat';
        '2002 LO2 DCVNC-2002 State.mat';
        '2006 LO2 DCVNC-2006 State.mat';
        '2010 LO2 DCVNO-2010 State.mat';
        '2027 LO2 DCVNO-2027 State.mat';
        '2031 LO2 DCVNC-2031 State.mat';
        '2032 LO2 DCVNO-2032 State.mat';
        '2035 LO2 DCVNO-2035 State.mat';
        '2040 LO2 DCVNO-2040 State.mat';
        '2056 LO2 DCVNC-2056 State.mat';
        '2067 LO2 DCVNO-2067 State.mat';
        '2093 LO2 DCVNC-2093 State.mat';
        '2096 LO2 DCVNC-2096 State.mat';
        '2097 LO2 DCVNC-2097 State.mat';
        '2099 LO2 DCVNO-2099 State.mat';
        '3009 LN2 DCVNC-3009 State.mat';
        '3010 LN2 DCVNC-3010 State.mat';
        '3014 LN2 DCVNC-3014 State.mat';
        '3015 LN2 DCVNC-3015 State.mat';
        '3025 LN2 DCVNC-3025 State.mat';
        '3026 LN2 DCVNO-3026 State.mat';
        '3051 LN2 DCVNC-3051 State.mat';
        '3056 LN2 DCVNO-3056 State.mat';
        '3066 LN2 DCVNC-3066 State.mat';
        '3068 LN2 DCVNO-3068 State.mat';
        '3092 LN2 DCVNC-3092 State.mat';
        '4061 Ghe DCVNO-4061 State.mat';
        '4062 Ghe DCVNO-4062 State.mat';
        '4063 Ghe DCVNC-4063 State.mat';
        '4070 Ghe DCVNC-4070 State.mat';
        '4083 Ghe DCVNC-4083 State.mat';
        '4084 Ghe DCVNC-4084 State.mat';
        '4085 Ghe DCVNC-4085 State.mat';
        '4089 Ghe DCVNO-4089 State.mat';
        '4106 Ghe DCVNC-4106 State.mat';
        '4183 Ghe DCVNC-4183 State.mat';
        '4193 Ghe DCVNC-4193 State.mat';
        '5015 GN2 DCVNC-5015 State.mat';
        '5047 GN2 DCVNO-5047 State.mat';
        '5078 GN2 DCVNC-5078 State.mat';
        '5079 GN2 DCVNO-5079 State.mat';
        '5106 GN2 DCVNC-5106 State.mat';
        '5126 GN2 DCVNC-5126 State.mat';
        '5127 GN2 DCVNC-5127 State.mat';
        '5178 GN2 DCVNO-5178 State.mat';
        '5179 GN2 DCVNO-5179 State.mat';
        '5198 GN2 DCVNC-5198 State.mat';
        '5245 ECS DCVNC-5245 State.mat';
        '5463 GN2 DCVNO-5463 State.mat';
        '5464 GN2 DCVNC-5464 State.mat';
        '8020 HSS DCVNO-8020 State.mat';
        '8021 HSS DCVNO-8021 State.mat';
        '8030 HSS DCVNC-8030 State.mat';
        '8031 HSS DCVNC-8031 State.mat';
        '8032 HSS DCVNC-8032 State.mat';
    };

%% Pressure Sensor FDs

filesPressure = { 
        '5903 GN2 PT-5903 Press Sensor Mon.mat';
        '5070 GN2 PT-5070 Press Sensor Mon.mat' 
    };


%% 

filesState      = sort(filesState);
filesCommand    = sort(filesCommand);

totalValves = numel(filesState);


%% Make all the plots!

[axHandles, figHandles, axPairArray] = makeManyMDRTSubplots(totalValves * 2, ...
            'All Valves for NG15', ...
            'plotswide',    5, ...
            'plotshigh',    4, ...
            'margin',       0.03, ...
            'gap',          0.025, ...
            'newStyle',     true );

        
%% Plot it all!

for fi = 1:totalValves
    
    [s, e] = regexp(filesState{fi}, '[DP]CVN[CO]-\d*');
    titleString = filesState{fi}(s:e);
    
    top = axPairArray(fi,1);
    bot = axPairArray(fi,2);
    
    top.addFDfromFile(fullfile(dataFolders, filesPressure{1}));
    top.addFDfromFile(fullfile(dataFolders, filesPressure{2}));
    top.title = titleString;
    
    bot.addFDfromFile(fullfile(dataFolders, filesState{fi}));
    bot.addFDfromFile(fullfile(dataFolders, filesCommand{fi}));
    bot.title = titleString;
    
    dynamicDateTicks([top.hAx, bot.hAx], 'link', 'x')
    top.hAx.YLim = [92 102];
    bot.hAx.YLim = [ -0.1 2.1 ];
    
end

linkaxes([axHandles.hAx]', 'x');

return

%% Save all these damn plots


path = '/Users/nick/Downloads'

for f = 1:axPairArray(end).hAx.Parent.Number
    
    fh = figure(f);
    
    sth = findobj(fh,'Tag','suptitle');
    graphTitle = sth.Children.String;
    
    defaultName = regexprep(graphTitle,'^[!@$^&*~?.|/[]<>\`";#()]','');
    defaultName = regexprep(defaultName, '[:]','-');
    
    
    saveas(fh, fullfile(path, defaultName),'pdf');
    
end

